<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" >
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>数当てゲーム</title>
</head>
<body>
  <h1>数当てゲーム</h1>
  <ul>
    <li>
      1から10までの数字を当てるゲームです
    </li>
    <li>
      ダイアログボックスに数字を入れて、当ててください
    </li>
    <li>
      やめたいときは「end」と入力してください。
    </li>
  </ul>

<script>
  const theNumber = getRandomInt();
  console.log(theNumber);
  setTimeout(numberGame, 1000, theNumber);

  function numberGame(theNumber) {
    let message = `1以上10以下の整数を（半角で）入力してください（1回目）: `;
    let count = 1;
    let answer = readUserAnswer(count, message);
    while (true) {
      if (answer === "end") break;
      
      if (answer === theNumber) {
        setTimeout(printSuccessMessage, 1000, count, answer);
        break;
      }
      
      count++;
      const mes1 = "1以上10以下の整数ではないので、";
      const mes2 = `ハズレです。\n1以上10以下の整数を入力してください（${count}回目）`;
      if (1 <= answer && answer <= 10) {
        answer = readUserAnswer( count, mes2);
      }
      else {
        answer = readUserAnswer( count, mes1+mes2)
      }
    }
  }
  

  // getRandomInt  1以上10以下の整数をランダムに返す
  function getRandomInt() {
    return Math.floor(Math.random() * 10) + 1;
  }
  
  function readUserAnswer(count, message) {
    const s = prompt(message);
    if (s === null || s === "end") {
      return "end";
    }
    const n = parseInt(s);
    if (isNaN(n)) {
      return -2;
    }
    return n;
  }
  
  function printSuccessMessage(count, answer) {
    mesBody = `おめでとうございます。「${answer}」が当たりです。`;
    if (count === 1) {
      alert("ビンゴ！" + mesBody + "\n一発で当たりましたね。素晴らしい！");
    }
    else {
      const adverb = count > 7 ? "ヤット" : "";
      /* ↑上の1行で、次の6行と同じことになる（知らない人には意味不明だが）
         if (count > 7) {
         adverb = "ヤット";
         }
         else {
         adverb = "";
         }   */       
      alert(mesBody + `\n${count}回目で${adverb}あたりましたね。`);
    }
  }
</script>

</body>
</html>
